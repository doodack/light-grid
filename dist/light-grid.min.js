/*!
 Light Grid 1.0.0-rc1 

 by Micha≈Ç Dudak (http://dudak.me)
 https://github.com/michaldudak/light-grid.git
 license: MIT

 build date: 2017-08-09T20:06:53.781Z
*/
!function(a,b){function c(a){var c=a[0],d=a[a.length-1],e=[c];do{if(c=c.nextSibling,!c)break;e.push(c)}while(c!==d);return b.element(e)}function d(a,c,d,e,f){function g(){i=k,h.filter&&(i=c(i,h.filter.expression,h.filter.comparator)),h.orderBy&&(i=d(i,h.orderBy.expression,h.orderBy.reverse)),j=i.length,h.limitTo&&(h.limitTo.begin<0&&(h.limitTo.begin=0),0!==h.limitTo.limit&&(h.limitTo.begin&&h.limitTo.begin>=j&&(h.limitTo.begin=0),i=e(i,h.limitTo.limit,h.limitTo.begin)))}var h,i,j,k=a,l=10;this.setModel=function(a){k=a,g()},this.getGridModel=function(){return i},this.getModelItemCount=function(){return j},this.getCurrentViewSettings=function(){return h},this.saveModel=function(){g()},this.orderBy=function(a,b){h.orderBy={expression:a,reverse:b},g()},this.limitTo=function(a,b){void 0===a||null===a?h.limitTo=null:h.limitTo={limit:a,begin:b||0},g()},this.page=function(a){h.limitTo&&h.limitTo.limit||(h.limitTo={limit:l}),h.limitTo.begin=h.limitTo.limit*a,g()},this.setPageSize=function(a){this.limitTo(a,0)},this.filter=function(a,b){h.filter={expression:a,comparator:b},g()},this.reset=function(){h=b.copy(f),g()},this.refresh=function(){g()},this.reset()}function e(a){var c=[];if(a.limitTo&&(a.limitTo.limit&&c.push("limit="+a.limitTo.limit),a.limitTo.begin&&c.push("begin="+a.limitTo.begin)),a.orderBy&&a.orderBy.expression&&(c.push("orderBy="+encodeURIComponent(a.orderBy.expression)),a.orderBy.reverse&&c.push("reverse=true")),a.filter&&a.filter.expression){var d=a.filter.expression;if(b.isString(d))c.push("search="+encodeURIComponent(d));else if(b.isObject(d)){var e=[];for(var f in d)if(d.hasOwnProperty(f)){var g=d[f];e.push(encodeURIComponent(f)+":"+encodeURIComponent(g))}c.push("search="+e.join(","))}}return c.join("&")}function f(a){return a}function g(a){return a}function h(){}function i(a,c,d,i,j,k){function l(){b.isFunction(w.settingsSerializer)||(w.settingsSerializer=e),b.isFunction(w.responseParser)||(w.responseParser=f),b.isFunction(w.errorHandler)||(w.errorHandler=h),b.isFunction(w.successHandler)||(w.successHandler=g)}function m(e){function f(){function a(a){var b=w.successHandler(a);if(!b)throw new Error("successCallback did not return any value. Did you forget to return the modified value?");var c=w.responseParser(b.data);o=c.data,p=c.totalResults,n=e,t=!1,u=!0,v.resolve(b)}function b(a){t=!1,w.errorHandler(a),v.reject(a)}t=!0,c.get(g).then(a,b)}if(!a)throw new Error("resourceUrl was not set");e?(s=b.extend({},s,e),e=b.extend({},n,s)):e=n;var g=a;l();var h=w.settingsSerializer(e);return h.length>0&&(g+=g.indexOf("?")===-1?"?":"&",g+=h),null!==r?(d.cancel(r),r=null):v=i.defer(),w.debounceTime?r=d(function(){r=null,s=null,f()},w.debounceTime):f(),v.promise}var n=b.copy(j),o=[],p=0,q=10,r=null,s=null,t=!1,u=!1,v=null;this.debounceTime=k,this.settingsSerializer=e;var w=this;this.isRequestPending=function(){return t},this.hasResults=function(){return o&&o.length>0},this.hasNoResults=function(){return o&&0===o.length&&!this.isRequestPending()&&u},this.getGridModel=function(){return o},this.getModelItemCount=function(){return p},this.getCurrentViewSettings=function(){return n},this.saveModel=function(b){return c.post(a,b)},this.orderBy=function(a,b){var c={orderBy:{expression:a,reverse:b||!1}};return m(c)},this.limitTo=function(a,b){var c={};return void 0===a||null===a?c.limitTo=null:c.limitTo={limit:a,begin:b||0},m(c)},this.page=function(a){return n.limitTo&&n.limitTo.limit||(n.limitTo={limit:q}),n.limitTo.begin=n.limitTo.limit*a,m()},this.setPageSize=function(a){return this.limitTo(a,0)},this.filter=function(a){var c={filter:{expression:a}},d=b.copy(n.limitTo);return d&&(d.begin=0,c.limitTo=d),m(c)},this.setViewSettings=function(a){return m(a)},this.refresh=function(){return m()},this.reset=function(){return n=b.copy(j),m()}}b.module("lightGrid",[]).constant("DEFAULT_VIEW","default"),b.module("lightGrid").directive("lgGrid",function(){"use strict";return{scope:!0,controller:["$scope","$attrs",function(a,b){this.getModel=function(){return a.grid.data},this.getInitialView=function(){return b.initialView},this.switchView=function(b){a.$parent.$broadcast("switchView:"+this.getIdentifier(),b)},this.getIdentifier=function(){return a.$$gridId}}],require:"lgGrid",link:{pre:function(a,b,c,d){a.$$gridId=Math.floor(1e6*Math.random()),a.grid={data:a.$eval(c.model),controller:d},a.$watch(c.model,function(b,c){b!==c&&(a.grid.data=b)}),b.addClass("light-grid")}}}}),b.module("lightGrid").directive("lgRow",["$parse","$animate","DEFAULT_VIEW",function(a,d,e){"use strict";function f(){return Object.create(null)}function g(a){var c={};this.switchView=function(c){a.row.view=c,a.row.viewModel=b.copy(a.row.data)},this.acceptViewModel=function(){b.extend(a.row.data,a.row.viewModel)},this.registerView=function(a){c[a]=!0},this.isViewRegistered=function(a){return!!c[a]}}/* Code based on Angular's ngRepeat: https://github.com/angular/angular.js/blob/master/src/ng/directive/ngRepeat.js */
var h="$$NG_REMOVED",i=function(a,c,d,f,g,h,i){a[d]=f,a.$index=c,a.$first=0===c,a.$last=c===g-1,a.$middle=!(a.$first||a.$last),
// jshint bitwise: false
a.$odd=!(a.$even=0===(1&c)),
// jshint bitwise: true
a.row={data:a.$$rowData,view:i.getInitialView()||e,viewModel:b.copy(a.$$rowData),controller:h},a.$on("switchView:"+i.getIdentifier(),function(a,b){h.switchView(b)})},j=function(a){return a.clone[0]},k=function(a){return a.clone[a.clone.length-1]};return{restrict:"A",multiElement:!0,transclude:"element",priority:1e3,terminal:!0,$$tlb:!0,require:"^lgGrid",compile:function(){var a=document.createComment(" end lgRow "),e="$$rowData",l="grid.data",m=function(a){return a};return function(n,o,p,q,r){
// Store a list of elements from previous run. This is a hash where key is the item from the
// iterator, and the value is objects with following properties.
// - scope: bound scope
// - element: previous element.
// - index: position
// We are using no-proto object so that we don't need to guard against inherited props via
// hasOwnProperty.
var s=f();
// watch props
n.$watchCollection(l,function(l){function n(a){a&&a.scope&&(s[a.id]=a)}var p,t,// node that cloned nodes should be inserted after
// initialized to the comment node anchor
u,v,w,x,// key/value of iteration
y,z,A,B,// last object information {scope, element, id}
C,D,E=o[0],
// Same as lastBlockMap but it has the current state. It will become the
// lastBlockMap on the next iteration.
F=f();z=m,
// if object, extract keys, in enumeration order, unsorted
A=[];for(var G in l)l.hasOwnProperty(G)&&"$"!==G.charAt(0)&&A.push(G);
// locate existing items
for(v=A.length,C=new Array(v),p=0;p<v;p++)if(w=l===A?p:A[p],x=l[w],y=z(w,x,p),s[y])
// found previously seen block
B=s[y],delete s[y],F[y]=B,C[p]=B;else{if(F[y])
// if collision detected restore lastBlockMap and throw an error
throw b.forEach(C,n),new Error("Duplicate rows detected. The grid cannot render the same row twice. Use angular.copy to create a new instance. Duplicate value: "+x);
// new never before seen block
C[p]={id:y,scope:void 0,clone:void 0},F[y]=!0}/* jshint forin:false */
// remove leftover items
for(var H in s){if(B=s[H],D=c(B.clone),d.leave(D),D[0].parentNode)for(
// if the element was not removed yet because of pending animation, mark it as deleted
// so that we can ignore it later
t=D.length,p=0;p<t;p++)D[p][h]=!0;B.scope.$destroy()}/* jshint forin:true */
// we are not using forEach for perf reasons (trying to avoid #call)
for(p=0;p<v;p++)if(w=l===A?p:A[p],x=l[w],B=C[p],B.scope){
// if we have already seen this object, then we need to reuse the
// associated scope/element
u=E;
// skip nodes that are already pending removal via leave animation
do u=u.nextSibling;while(u&&u[h]);j(B)!==u&&
// existing item which got moved
d.move(c(B.clone),null,b.element(E)),E=k(B),i(B.scope,p,e,x,v,new g(B.scope),q)}else/* jshint loopfunc:true */
// new item which we don't know about
r(function(c,f){B.scope=f;
// http://jsperf.com/clone-vs-createcomment
var h=a.cloneNode(!1);c[c.length++]=h,
// TODO(perf): support naked previousNode in `enter` to avoid creation of jqLite wrapper?
d.enter(c,null,b.element(E)),E=h,
// Note: We only need the first/last node of the cloned nodes.
// However, we need to keep the reference to the jqlite wrapper as it might be changed later
// by a directive with templateUrl when its template arrives.
B.clone=c,F[B.id]=B,i(B.scope,p,e,x,v,new g(B.scope),q)});s=F})}}}}]),b.module("lightGrid").directive("lgView",function(){"use strict";return{transclude:"element",priority:600,// as ngIf
link:function(a,c,d,e,f){var g,h=d.lgView||d.view;g=h?h.split(",").map(function(a){return a.trim()}):[],g.forEach(function(b){a.row.controller.registerView(b)}),a.shouldShowDefaultView=function(b){return!a.row.controller.isViewRegistered(b)};var i;i=0===g.length?"shouldShowDefaultView(row.view)":g.map(function(a){return"row.view === '"+a+"'"}).join(" || ");var j=document.createComment("lgView");c.after(j);var k=!1,l=null;a.$watch(i,function(a){a&&!k?(f(function(a){var c=b.element(j);c.parent()[0].insertBefore(a[0],c[0]),l=a}),k=!0):!a&&k&&(l.remove(),l=null,k=!1)})}}}),b.module("lightGridDataProviders",["lightGrid"]),b.module("lightGridDataProviders").provider("lgLocalDataProviderFactory",function(){var a=this;this.defaultViewSettings={orderBy:null,limitTo:null,filter:null},this.$get=["filterFilter","orderByFilter","limitToFilter",function(b,c,e){return{create:function(f){return new d(f,b,c,e,a.defaultViewSettings)}}}]}),b.module("lightGridDataProviders").provider("lgServerDataProviderFactory",function(){var a=this;this.defaultViewSettings={orderBy:null,limitTo:null,filter:null},this.debounceTime=150,this.$get=["$http","$timeout","$q",function(b,c,d){return{create:function(e){return new i(e,b,c,d,a.defaultViewSettings,a.debounceTime)}}}]}),b.module("lightGridControls",["lightGrid"]),b.module("lightGridControls").directive("lgExpandedRow",["$animate",function(a){"use strict";/* Code based on Angular's ngIf directive: https://github.com/angular/angular.js/blob/master/src/ng/directive/ngIf.js */
return{multiElement:!0,transclude:"element",priority:600,terminal:!0,restrict:"A",require:"^?lgRow",$$tlb:!0,link:function(b,d,e,f,g){var h,i,j;b.$watch("row.expanded",function(b){b?i||g(function(b,c){i=c,b[b.length++]=document.createComment(" end lgExpandedRow "),
// Note: We only need the first/last node of the cloned nodes.
// However, we need to keep the reference to the jqlite wrapper as it might be changed later
// by a directive with templateUrl when its template arrives.
h={clone:b},a.enter(b,d.parent(),d)}):(j&&(j.remove(),j=null),i&&(i.$destroy(),i=null),h&&(j=c(h.clone),a.leave(j).then(function(){j=null}),h=null))})}}}]),b.module("lightGridControls").directive("lgPager",function(){"use strict";return{scope:{provider:"="},template:"<div class='pager'><button ng-disabled='isFirst' class='first' ng-click='goToFirst()'>First</button><button ng-disabled='isFirst' class='previous' ng-click='goToPrevious()'>Previous</button><span class='pager-summary'>Page {{currentPage + 1}} of {{pageCount}}</span><button ng-disabled='isLast' class='next' ng-click='goToNext()'>Next</button><button ng-disabled='isLast' class='last' ng-click='goToLast()'>Last</button></div>",link:function(a){function b(a,b,c){return 0===c?-1:Math.floor(a/b)}function c(a,b){return Math.ceil(b/a)}function d(d){var e=a.provider.getModelItemCount();d?(a.currentPage=b(d.begin,d.limit,e),a.pageCount=c(d.limit,e),f=d.limit):(a.currentPage=0,a.pageCount=1,f=1),a.isFirst=a.currentPage<=0,a.isLast=a.currentPage>=a.pageCount-1}function e(b){b<0?b=0:b>=a.pageCount&&(b=a.pageCount-1),a.provider.page(b)}var f;a.$watch("provider",function(a){a&&(d(a.getCurrentViewSettings().limitTo),e(0))}),a.$watch("provider.getCurrentViewSettings().limitTo",function(a){d(a)},!0),a.$watch("provider.getModelItemCount()",function(){d(a.provider.getCurrentViewSettings().limitTo)}),a.goToFirst=function(){e(0)},a.goToPrevious=function(){e(a.currentPage-1)},a.goToNext=function(){e(a.currentPage+1)},a.goToLast=function(){e(a.pageCount-1)}}}}),b.module("lightGridControls").directive("lgPageSizeOptions",["$window",function(a){"use strict";return{scope:{provider:"=",pageSizeOptions:"=?options"},template:"<div class='page-size'><select class='form-control' ng-options='size for size in pageSizeOptions' ng-model='pageSize' ng-change='pageSizeChanged()'></select></div>",link:function(c){function d(a){b.isNumber(a)&&null!==a&&b.isDefined(a)&&c.pageSizeOptions.indexOf(a)===-1&&(c.pageSizeOptions.push(a),c.pageSizeOptions=c.pageSizeOptions.sort(function(a,b){return a-b}))}var e=[10,25,50];c.pageSizeOptions=c.pageSizeOptions||e,c.$watch("provider",function(a){a&&(c.pageSize=a.getCurrentViewSettings().limitTo&&a.getCurrentViewSettings().limitTo.limit,d(c.pageSize))}),c.pageSizeChanged=function(){d(c.pageSize),c.provider.setPageSize(c.pageSize)},c.$watchCollection("pageSizeOptions",function(){var f=!0;b.isArray(c.pageSizeOptions)||(f=!1),f&&c.pageSizeOptions.length<=0&&(f=!1),f&&!c.pageSizeOptions.every(function(a){return b.isNumber(a)})&&(f=!1),f||(a.console.warn("Page size options are incorrect, using default values",c.pageSizeOptions),c.pageSizeOptions=e),d(c.pageSize)}),c.$watch("provider.getCurrentViewSettings().limitTo.limit",function(a){d(a),c.pageSize=a})}}}]),b.module("lightGridControls").directive("lgPersistData",["$q","DEFAULT_VIEW",function(a,b){"use strict";return{restrict:"A",link:function(c,d,e){d.on("click",function(){var d=c.$eval(e.provider),f=c.row.controller;a.when(d.saveModel(c.viewData)).then(function(){f&&(f.acceptViewModel(),f.switchView(b))})})}}}]),b.module("lightGridControls").directive("lgSorter",["$timeout",function(a){"use strict";return{template:"<span class='sorter {{ cssClass }}'><span ng-transclude class='columnTitle'></span></span>",transclude:!0,replace:!0,scope:{dataProvider:"=provider"},link:function(b,c,d){function e(){b.isSorted?b.cssClass=b.sortDirectionDescending?"sorter-desc":"sorter-asc":b.cssClass=""}var f=d.sortProperty||d.lgSorter;b.isSorted=!1,b.sortDirectionDescending=!0,c.on("click",function(){a(function(){b.dataProvider.orderBy(f,!b.sortDirectionDescending)})}),b.$watch("dataProvider.getCurrentViewSettings().orderBy",function(a){a?(b.isSorted=f===a.expression,b.sortDirectionDescending=!b.isSorted||a.reverse):(b.isSorted=!1,b.sortDirectionDescending=!0),e()})}}}]),b.module("lightGridControls").directive("lgSwitchView",["$timeout",function(a){"use strict";return{restrict:"A",link:function(b,c,d){var e=d.lgSwitchView;c.on("click",function(){a(function(){b.row.controller.switchView(e)})})}}}]),b.module("lightGridControls").directive("lgToggleExpandedRow",["$timeout",function(a){"use strict";return{require:"^?lgRow",restrict:"A",link:function(b,c){c.on("click",function(){a(function(){b.row.expanded=!b.row.expanded})})}}}])}(window,window.angular);
//# sourceMappingURL=light-grid.min.js.map